# π”§ AI Text Detector Backend

AI μƒμ„± ν…μ¤νΈ νƒμ§€λ¥Ό μ„ν• **Hierarchical Explanation API** λ°±μ—”λ“

---

## π“ νμΌ κµ¬μ΅°

```
backend/
β”β”€β”€ __init__.py          # ν¨ν‚¤μ§€ μ΄κΈ°ν™”
β”β”€β”€ main.py              # FastAPI μ—”νΈλ¦¬ν¬μΈνΈ
β”β”€β”€ model_loader.py      # λ¨λΈ μ²΄ν¬ν¬μΈνΈ κ΄€λ¦¬
β”β”€β”€ inference.py         # μ¶”λ΅  μ„λΉ„μ¤ (λ¬Έλ‹¨ λ¶„μ„, LOO)
β”β”€β”€ lime_analyzer.py     # LIME λ¶„μ„, μ‹ λΆ°λ„ κ²€μ¦
β”β”€β”€ meta_analyzer.py     # λ¬Έμ²΄ λ¶„μ„ (EDA κΈ°λ° ν†µκ³„ μ§€λ¬Έ)
β”β”€β”€ schemas.py           # Pydantic μ”μ²­/μ‘λ‹µ λ¨λΈ
β””β”€β”€ requirements.txt     # Python μμ΅΄μ„±
```

---

## π”„ μ „μ²΄ νμ΄ν”„λΌμΈ

```
μ…λ ¥ λ¬Έμ„
    β”‚
    β–Ό
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚  1. λ¬Έλ‹¨ λ¶„λ¦¬ (Paragraph Splitting)      β”‚
β”‚     - \n κΈ°μ¤€ λ¶„λ¦¬, μµμ† 50μ μ΄μƒ        β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
    β”‚
    β–Ό
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚  2. λ¬Έλ‹¨λ³„ AI ν™•λ¥  κ³„μ‚°                   β”‚
β”‚     - κ° λ¬Έλ‹¨μ„ BERTμ— κ°λ³„ μ¶”λ΅           β”‚
β”‚     - κ°€μ¥ λ†’μ€ ν™•λ¥ μ λ¬Έλ‹¨ = Top λ¬Έλ‹¨     β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
    β”‚
    β–Ό
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚  3. Leave-One-Out μ¤‘μ”λ„                 β”‚
β”‚     - κ° λ¬Έλ‹¨ μ κ±° μ‹ μ „μ²΄ μ μ λ³€ν™” μΈ΅μ •  β”‚
β”‚     - μ κ±° μ‹ μ μ ν•λ½ = ν•΄λ‹Ή λ¬Έλ‹¨ μ¤‘μ”   β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
    β”‚
    β–Ό
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚  4. LIME λ¶„μ„ (Top λ¬Έλ‹¨)                 β”‚
β”‚     - ν† ν°λ³„ μ¤‘μ”λ„ κ³„μ‚°                  β”‚
β”‚     - μ–‘μ score = AI μ§€ν‘                β”‚
β”‚     - μμ score = Human μ§€ν‘             β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
    β”‚
    β–Ό
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚  5. Deletion Test (μ‹ λΆ°λ„ κ²€μ¦)           β”‚
β”‚     - LIME μƒμ„ ν† ν° μ‚­μ  ν›„ ν™•λ¥  λ³€ν™”     β”‚
β”‚     - ν¬κ² ν•λ½ β†’ μ„¤λ… μ‹ λΆ°λ„ λ†’μ         β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
    β”‚
    β–Ό
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚  6. λ¬Έμ²΄ λ¶„μ„ (Stylistic Fingerprint)    β”‚
β”‚     - EDA κΈ°λ° 5λ€ μ§€ν‘ ν†µκ³„ λΉ„κµ          β”‚
β”‚     - Human/AI λ¶„ν¬ λ€λΉ„ p-value μ‚°μ¶      β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
    β”‚
    β–Ό
μ‘λ‹µ λ°ν™
```

---

## π“΅ API μ—”λ“ν¬μΈνΈ

### 1. `GET /checkpoints`
μ‚¬μ© κ°€λ¥ν• λ¨λΈ μ²΄ν¬ν¬μΈνΈ λ©λ΅ λ°ν™

**Response:**
```json
{
  "checkpoints": ["best_model.pt", "mil_model.pt"]
}
```

---

### 2. `POST /checkpoints/load`
νΉμ • μ²΄ν¬ν¬μΈνΈ λ΅λ“

**Request:**
```json
{
  "checkpoint_name": "best_model.pt"
}
```

**Response:**
```json
{
  "status": "loaded",
  "model_name": "best_model.pt"
}
```

---

### 3. `POST /analyze` β­ λ©”μΈ μ—”λ“ν¬μΈνΈ
μ „μ²΄ λ¶„μ„ νμ΄ν”„λΌμΈ μ‹¤ν–‰

**Request:**
```json
{
  "text": "λ¶„μ„ν•  λ¬Έμ„ ν…μ¤νΈ..."
}
```

**Response:**
```json
{
  "prediction": "AI",
  "confidence": 0.87,
  "paragraphs": [
    {"index": 0, "text": "λ¬Έλ‹¨1...", "ai_prob": 0.92, "importance": 0.15},
    {"index": 1, "text": "λ¬Έλ‹¨2...", "ai_prob": 0.65, "importance": 0.08}
  ],
  "top_paragraph": {
    "index": 0,
    "text": "ν•µμ‹¬ λ¬Έλ‹¨...",
    "ai_prob": 0.92
  },
  "lime_result": {
    "tokens": [
      {"word": "νλ…μ μΈ", "score": 0.45},
      {"word": "μΈκ°„", "score": -0.12}
    ]
  },
  "deletion_test": {
    "original_prob": 0.92,
    "modified_prob": 0.61,
    "drop": 0.31,
    "reliability": "high",
    "removed_tokens": ["νλ…μ μΈ", "κ·Όλ³Έμ μΌλ΅"]
  },
  "meta_analysis": {
    "features": [
      {
        "feature_name": "comma_density",
        "display_name": "μ‰Όν‘ λ°€λ„ (100μλ‹Ή)",
        "value": 0.72,
        "human_stats": {"mean": 1.10, "std": 0.60},
        "ai_stats": {"mean": 0.72, "std": 0.49},
        "p_value": 0.04,
        "interpretation": "μ΄ ν”Όμ²λ” AI κ·Έλ£Ήμ ν‰κ· μΉμ— λ” κ°€κΉμµλ‹λ‹¤."
      }
    ],
    "overall_interpretation": "μ£Όμ” 5κ° μ§€ν‘ μ¤‘ 4κ°κ°€ AI ν¨ν„΄μ„ λ³΄μ…λ‹λ‹¤."
  }
}
```

---

## π“¦ λ¨λ“λ³„ μ„¤λ…

### `model_loader.py`
| ν•¨μ | μ„¤λ… |
|------|------|
| `list_checkpoints()` | `checkpoints/` ν΄λ”μ λ¨λΈ νμΌ λ©λ΅ |
| `load_checkpoint(name)` | μ²΄ν¬ν¬μΈνΈ λ΅λ“ (HuggingFace/PyTorch μ§€μ›) |
| `get_model()` | ν„μ¬ λ΅λ“λ λ¨λΈ λ°ν™ |
| `get_tokenizer()` | BERT ν† ν¬λ‚μ΄μ € λ°ν™ |

### `inference.py`
| ν•¨μ | μ…λ ¥ | μ¶λ ¥ |
|------|------|------|
| `split_paragraphs(text)` | λ¬Έμ„ ν…μ¤νΈ | λ¬Έλ‹¨ λ¦¬μ¤νΈ |
| `predict_proba(texts)` | ν…μ¤νΈ λ¦¬μ¤νΈ | `(n, 2)` ν™•λ¥  λ°°μ—΄ |
| `get_paragraph_contributions(paras)` | λ¬Έλ‹¨ λ¦¬μ¤νΈ | λ¬Έλ‹¨λ³„ AI ν™•λ¥ , Top λ¬Έλ‹¨ |
| `get_paragraph_importance_loo(paras)` | λ¬Έλ‹¨ λ¦¬μ¤νΈ | μ¤‘μ”λ„ λ°°μ—΄, κΈ°μ¤€ μ μ |
| `analyze_document(text)` | λ¬Έμ„ ν…μ¤νΈ | μ „μ²΄ λ¶„μ„ κ²°κ³Ό dict |

### `lime_analyzer.py`
| ν•¨μ | μ…λ ¥ | μ¶λ ¥ |
|------|------|------|
| `explain_text(text)` | ν…μ¤νΈ | LIME ν† ν° λ¦¬μ¤νΈ |
| `deletion_test(text, lime_result)` | ν…μ¤νΈ, LIME κ²°κ³Ό | μ‚­μ  ν…μ¤νΈ κ²°κ³Ό |
| `full_analysis(text)` | ν…μ¤νΈ | LIME + Deletion Test |

### `meta_analyzer.py`
| ν•¨μ | μ…λ ¥ | μ¶λ ¥ |
|------|------|------|
| `extract_features(text)` | ν…μ¤νΈ | 5λ€ λ¬Έμ²΄ μ§€ν‘ dict |
| `analyze(text)` | ν…μ¤νΈ | ν†µκ³„μ  λΉ„κµ κ²°κ³Ό (MetaAnalysisResult) |

---

## π€ μ‹¤ν–‰ λ°©λ²•

```bash
# 1. μμ΅΄μ„± μ„¤μΉ
cd backend
pip install -r requirements.txt

# 2. μ²΄ν¬ν¬μΈνΈ ν΄λ” μ¤€λΉ„ (μ„ νƒ)
mkdir -p ../checkpoints
# μ²΄ν¬ν¬μΈνΈ νμΌ λ³µμ‚¬

# 3. μ„λ²„ μ‹¤ν–‰
uvicorn main:app --reload --port 8000

# 4. API λ¬Έμ„ ν™•μΈ
# http://localhost:8000/docs
```

---

## π”— ν”„λ΅ νΈμ—”λ“ μ—°λ™

`frontend/js/api.js`μ—μ„:
```javascript
const USE_MOCK_DATA = false;  // true β†’ falseλ΅ λ³€κ²½
const API_BASE_URL = 'http://localhost:8000';
```

---

## π“ μ£Όμμ‚¬ν•­

- **LIME λ¶„μ„**μ€ `num_samples=500`μΌλ΅ μ„¤μ •λμ–΄ μμ–΄ μ•½κ°„μ μ‹κ°„μ΄ μ†μ”λ©λ‹λ‹¤
- μ²΄ν¬ν¬μΈνΈκ°€ μ—†μΌλ©΄ `klue/bert-base` κΈ°λ³Έ λ¨λΈλ΅ λ™μ‘ν•©λ‹λ‹¤
- GPU μ‚¬μ© μ‹ μλ™μΌλ΅ CUDAλ΅ μ „ν™λ©λ‹λ‹¤
